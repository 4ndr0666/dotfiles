#!/bin/sh
# Author: 4ndr0666
# ========================== // LINKHANDLER //
## Description: Feed script a url or file location.
#               If an image, it will view in nsxiv,
#               if a video or gif, it will view in mpv
#               if a music file or pdf, it will download,
#               otherwise it opens link in browser.
# ---------------------------------------------

## Dynamic Clipboard

clip() {
	command -v wl-paste >/dev/null
	wl-paste || {
		xclip -o
	}
}

## Validate

if [ -z "$1" ]; then
	url=clip
else
	url="$1"
fi

## Options

case "$url" in
*mkv | *webm | *mp4 | *youtube.com/watch* | *youtube.com/playlist* | *youtube.com/shorts* | *youtu.be* | *youtube.com/embed* | *redgifs.com* | *hooktube.com* | *bitchute.com* | *fanvue.com* | *odysee.com*)
	setsid -f mpv -quiet "$url" >/dev/null 2>&1
	;;
*png | *jpg | *jpe | *jpeg | *gif | *webp)
	curl -sL "$url" >"/tmp/$(echo "$url" | sed "s/.*\///;s/%20/ /g")" && nsxiv -a "/tmp/$(echo "$url" | sed "s/.*\///;s/%20/ /g")" >/dev/null 2>&1 &
	;;
*pdf | *cbz | *cbr)
	curl -sL "$url" >"/tmp/$(echo "$url" | sed "s/.*\///;s/%20/ /g")" && zathura "/tmp/$(echo "$url" | sed "s/.*\///;s/%20/ /g")" >/dev/null 2>&1 &
	;;
*mp3 | *flac | *opus | *mp3?source*)
	qndl "$url" 'curl -LO' >/dev/null 2>&1
	;;
*)
	[ -f "$url" ] && setsid -f "$TERMINAL" -e "$EDITOR" "$url" >/dev/null 2>&1 || setsid -f "$BROWSER" "$url" >/dev/null 2>&1
	;;
esac
